<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="address" name="Contacto - Pago" inherit_id="website_sale.address">
		<xpath expr="//div[@id='wrap']" position="replace">
			<div id="wrap">
				<div class="oe_website_sale o_wsale_address_fill container py-2">
					<div class="row">
						<div class="col-12">
							<t t-call="website_sale.wizard_checkout" />
						</div>
					</div>
					<div class="row">
						<div class="oe_cart col-12 col-lg-8">
							<div>
								<t t-set="address_mode" t-value="mode[1]" />
								<t t-if="is_public_order">
									<h3 class="mb-3">
										<span t-if="account_on_checkout != 'mandatory'">
											Fill in your address
										</span>
										<small class="text-muted" t-if="account_on_checkout == 'optional'">
											or
										</small>
										<a t-if="account_on_checkout != 'disabled'" role="button" href="/web/login?redirect=/shop/checkout" style="margin-top: -11px">
											Sign in
										</a>
									</h3>
								</t>
								<t t-elif="address_mode == 'billing'">
									<h3 class="mb-3">
										Billing address
									</h3>
								</t>
								<t t-else="">
									<h3 class="mb-3">
										Shipping address
									</h3>
								</t>
								<t t-if="partner_id == website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id">
									<div class="alert alert-warning" role="alert" t-if="not only_services" groups="account.group_delivery_invoice_address">
										<h4 class="alert-heading">
											Be aware!
										</h4>
										<p>
											You are editing your
											<b>
												billing and shipping
											</b>
											addresses at the same time!
											<br />
											If you want to modify your shipping address, create a
											<a href="/shop/address">
												new address
											</a>
											.
										</p>
									</div>
								</t>
								<t t-if="error" t-foreach="error.get('error_message', [])" t-as="err">
									<div class="alert alert-danger">
										<h6 class="text-danger" t-esc="err" />
									</div>
								</t>
								<form t-if="account_on_checkout != 'mandatory' or not is_public_user" action="/shop/address" method="post" class="checkout_autoformat">
									<div class="row">
										<h5 class="mt-4">
											Información del contacto
										</h5>
										<div t-attf-class="#{error.get('email') and 'o_has_error'} input-text  col-lg-6 mb-2" id="div_email">
											<!-- <label t-attf-class="col-form-label #{mode[1] == 'shipping' and 'label-optional' or ''}" for="email">Email</label> -->
											<input type="email" placeholder="Dirección de correo electrónico *" name="email" t-attf-class="form-control #{error.get('email') and 'is-invalid' or ''}" t-att-value="'email' in checkout and checkout['email']" />
										</div>
										<h5 class="mt-4">
											Detalles de facturación
										</h5>
										<t t-if="website._display_partner_b2b_fields()">
											<div class="w-100" />
											<t t-set="vat_warning" t-value="'vat' in checkout and checkout['vat'] and not can_edit_vat" />
											<t t-if="(mode == ('new', 'billing') and is_public_order                                                 or mode == ('edit', 'billing') and partner_id == website_sale_order.partner_id.id)                                                 and (can_edit_vat or 'vat' in checkout and checkout['vat'])">
												<div t-attf-class="#{error.get('vat') and 'o_has_error'} div_vat col-lg-6 mb-2">
													<label class="col-form-label fw-normal label-optional " for="vat">
														Numero de Indentificacion
													</label>
													<input type="text" name="vat" id="o_vat" t-attf-class="form-control #{error.get('vat') and 'is-invalid' or ''}" t-att-value="'vat' in checkout and checkout['vat']" t-att-readonly="'1' if vat_warning else None" />
													<small t-if="vat_warning" class="form-text text-muted d-block d-lg-none">
														Changing VAT number is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.
													</small>
												</div>
												<div t-if="vat_warning" class="col-12 d-none d-lg-block mb-1">
													<small class="form-text text-muted">
														Changing company name or VAT number is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.
													</small>
												</div>
												<div id="company_name_div" t-attf-class="#{error.get('company_name') and 'o_has_error'} col-12 mb-2">
													<label class="col-form-label fw-normal label-optional" for="company_name">
														Nombre de tu Compañia
													</label>
													<input type="text" id="o_company_name" name="company_name" t-attf-class="form-control #{error.get('company_name') and 'is-invalid' or ''}" t-att-value="'commercial_company_name' in checkout and checkout['commercial_company_name'] or 'company_name' in checkout and checkout['company_name']" t-att-readonly="'1' if vat_warning else None" />
													<small t-if="vat_warning" class="form-text text-muted d-block d-lg-none">
														Changing company name is not allowed once document(s) have been issued for your account. Please contact us directly for this operation.
													</small>
												</div>
											</t>
										</t>
										<div t-attf-class="#{error.get('name') and 'o_has_error'} div_name col-lg-12 mb-2">
											<label class="col-form-label" for="name">
												Nombres y Apellidos
											</label>
											<input type="text" id="o_name" name="name" t-attf-class="form-control #{error.get('name') and 'is-invalid' or ''}" t-att-value="'name' in checkout and checkout['name']" />
										</div>
										<div class="w-100" />
										<div t-attf-class="#{error.get('phone') and 'o_has_error'} col-lg-6 mb-2" id="div_phone">
											<label class="col-form-label " for="phone">
												Teléfono *
											</label>
											<input type="tel" name="phone" t-attf-class="form-control #{error.get('phone') and 'is-invalid' or ''}" t-att-value="'phone' in checkout and checkout['phone']" />
										</div>
										<t t-set="zip_city" t-value="country and [x for x in country.get_address_fields() if x in [&quot;zip&quot;, &quot;city&quot;]] or [&quot;city&quot;, &quot;zip&quot;]" />
										<t t-if="'zip' in zip_city and zip_city.index('zip') &lt; zip_city.index('city')">
											<div t-attf-class="#{error.get('zip') and 'o_has_error'} div_zip col-lg-6 mb-2">
												<label class="col-form-label label-optional" for="zip">
													Codigo postal
												</label>
												<input type="text" name="zip" t-attf-class="form-control #{error.get('zip') and 'is-invalid' or ''}" t-att-value="'zip' in checkout and checkout['zip']" />
											</div>
										</t>
										<h5 class="mt-4">
											Direccion del contacto
										</h5>
										<div t-attf-class="#{error.get('street') and 'o_has_error'} div_street col-lg-12 mb-2">
											<label class="col-form-label " for="street">
												Nombre de la calle y número de la casa *
											</label>
											<input type="text" id="o_street" name="street" t-attf-class="form-control #{error.get('street') and 'is-invalid' or ''}" t-att-value="'street' in checkout and checkout['street']" />
										</div>
										<div t-attf-class="mb-2 d-none #{error.get('street2') and 'o_has_error' or ''} col-lg-12 div_street2">
											<label class="col-form-label label-optional" for="street2">
												Apartment, suite, etc.
											</label>
											<input type="text" name="street2" t-attf-class="form-control #{error.get('street2') and 'is-invalid' or ''}" t-att-value="'street2' in checkout and checkout['street2']" />
										</div>
										<div class="w-100" />
										<div t-attf-class="#{error.get('city') and 'o_has_error' or ''} div_city col-md-8 mb-2">
											<label class="col-form-label" for="city">
												Ciudad
											</label>
											<input type="text" name="city" t-attf-class="form-control #{error.get('city') and 'is-invalid' or ''}" t-att-value="'city' in checkout and checkout['city']" />
										</div>
										<t t-if="'zip' in zip_city and zip_city.index('zip') &gt; zip_city.index('city')">
											<div t-attf-class="#{error.get('zip') and 'o_has_error'} div_zip col-md-4 mb-2">
												<label class="col-form-label label-optional" for="zip">
													Zip Code
												</label>
												<input type="text" name="zip" t-attf-class="form-control #{error.get('zip') and 'is-invalid' or ''}" t-att-value="'zip' in checkout and checkout['zip']" />
											</div>
										</t>
										<div class="w-100" />
										<div t-attf-class="#{error.get('country_id') and 'o_has_error'} div_country col-lg-6 mb-2">
											<label class="col-form-label" for="country_id">
												País
											</label>
											<select id="country_id" name="country_id" t-attf-class="form-select #{error.get('country_id') and 'is-invalid' or ''}" t-att-mode="mode[1]">
												<option value="">
													País...
												</option>
												<t t-foreach="countries" t-as="c">
													<option t-att-value="c.id" t-att-selected="(country and c.id == country.id) or (not country and c.code == 'PE')" t-att-code="c.code">
														<t t-esc="c.name" />
													</option>
												</t>
											</select>
										</div>
										<div t-attf-class="#{error.get('state_id') and 'o_has_error'} div_state col-lg-6 mb-2" t-att-style="(not country or not country.state_ids) and 'display: none'">
											<label class="col-form-label" for="state_id">
												Departamento
											</label>
											<select name="state_id" t-attf-class="form-select #{error.get('state_id') and 'is-invalid' or ''}" data-init="1">
												<option value="">
													Departamento...
												</option>
												<t t-foreach="country_states" t-as="s">
													<option t-att-value="s.id" t-att-selected="s.id == ('state_id' in checkout and country and checkout['state_id'] != '' and int(checkout['state_id']))">
														<t t-esc="s.name" />
													</option>
												</t>
											</select>
										</div>
										<div class="w-100" />
										<t t-if="mode == ('new', 'billing') and not only_services">
											<div class="col-lg-12">
												<div class="form-check form-switch mt-2 mb-3">
													<label>
														<input type="checkbox" id="shipping_use_same" class="form-check-input mr8" name="use_same" value="1" t-att-checked="use_same" />
														Ship to the same address
														<span t-if="is_public_user" class="form-check-label ship_to_other text-muted" style="display: none">
															&amp;nbsp;(
															<i>
																Your shipping address will be requested later)
															</i>
														</span>
													</label>
												</div>
											</div>
										</t>
										<t t-else="">
											<input type="hidden" name="use_same" t-att-value="partner_id == website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id" />
										</t>
									</div>
									<input type="hidden" name="csrf_token" t-att-value="request.csrf_token()" t-nocache="The csrf token must always be up to date." />
									<input type="hidden" name="submitted" value="1" />
									<input type="hidden" name="partner_id" t-att-value="partner_id or '0'" />
									<input type="hidden" name="mode" t-att-value="mode[1]" />
									<input type="hidden" name="callback" t-att-value="callback" />
									<!-- Example -->
									<input type="hidden" name="field_required" t-att-value="'name,street'" />
									<div class="d-flex flex-column flex-md-row align-items-center justify-content-between mt32 mb32">
										<a role="button" t-att-href="mode == ('new', 'billing') and '/shop/cart' or '/shop/checkout'" class="btn btn-outline-secondary w-100 w-md-auto order-md-1 order-3">
											<i class="fw-light fa fa-angle-left me-2" />
											Cancelar
										</a>
										<div class="position-relative w-100 d-flex d-md-none justify-content-center align-items-center order-2 my-2 opacity-75">
											<hr class="w-100" />
											<span class="px-3">
												or
											</span>
											<hr class="w-100" />
										</div>
										<a role="button" href="#" class="a-submit a-submit-disable a-submit-loading btn btn-primary w-100 w-md-auto order-1 order-md-3">
											<t t-if="mode == ('new', 'billing')">
												Continuar pagando
											</t>
											<t t-else="">
												Guardar dirección
											</t>
											<i class="fw-light fa fa-angle-right ms-2" />
										</a>
									</div>
								</form>
							</div>
						</div>
						<div class="oe_cart col-12 col-lg-4">
							<div class="o_total_card sticky-lg-top">
								<div id="o_wsale_total_accordion_item" class="accordion-item p-lg-4 border-0">
									<div class="accordion-header d-block align-items-center mb-4">
										<button class="accordion-button px-0 collapsed" data-bs-toggle="collapse" data-bs-target="#o_wsale_accordion_item" aria-expanded="false" aria-controls="o_wsale_accordion_item">
											<div class="d-flex flex-wrap">
												<b class="w-100">
													Resumen del pedido
												</b>
												<span t-out="str(website_sale_order.cart_quantity)" />
												&amp;nbsp;item(s)&amp;nbsp;-&amp;nbsp;
												<span id="amount_total_summary" class="monetary_field ms-1" t-field="website_sale_order.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: website_sale_order.currency_id}" />
											</div>
										</button>
									</div>
									<div name="cart_summary_info" t-if="not website_sale_order or not website_sale_order.website_order_line" class="alert alert-info">
										¡Tu carrito está vacío!
									</div>
									<div id="o_wsale_accordion_item" class="accordion-collapse collapse mb-4 mb-lg-0" data-bs-parent="#o_wsale_total_accordion">
										<div t-att-class="len(website_sale_order.website_order_line) &gt; 3 and 'o_wsale_scrollable_table mt-n4 me-n4 pt-4 pe-4'">
											<table t-if="website_sale_order and website_sale_order.website_order_line" class="table accordion-body mb-0" id="cart_products">
												<tbody>
													<tr t-foreach="website_sale_order.website_order_line" t-as="line" t-att-class="line_last and 'border-transparent'">
														<t t-set="o_cart_sum_padding_top" t-value="'pt-3' if line_size &gt; 1 and not line_first else 'pt-0'" />
														<td t-if="not line.product_id" colspan="2" />
														<t t-else="">
															<td t-attf-class="td-img ps-0 #{o_cart_sum_padding_top}">
																<span t-if="line._is_not_sellable_line() and line.product_id.image_128">
																	<img t-att-src="image_data_uri(line.product_id.image_128)" class="o_image_64_max img rounded" t-att-alt="line.name_short" />
																</span>
																<span t-else="" t-field="line.product_id.image_128" t-options="{'widget': 'image', 'qweb_img_responsive': False, 'class': 'o_image_64_max rounded'}" />
															</td>
															<td t-attf-class="#{o_cart_sum_padding_top} td-product_name td-qty w-100" name="website_sale_cart_summary_product_name">
																<h6>
																	<t t-out="int(line.product_uom_qty)" />
																	<t t-if="line._get_shop_warning(clear=False)">
																		<i class="fa fa-warning text-warning" role="img" t-att-title="line._get_shop_warning()" aria-label="Warning" />
																	</t>
																	x
																	<t t-out="line.name_short" />
																</h6>
															</td>
														</t>
														<td t-attf-class="#{o_cart_sum_padding_top} td-price pe-0 text-end" name="website_sale_cart_summary_line_price">
															<span t-if="website.show_line_subtotals_tax_selection == 'tax_excluded'" t-field="line.price_subtotal" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
															<span t-else="" t-field="line.price_total" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
														</td>
													</tr>
												</tbody>
											</table>
										</div>
										<t t-if="website_sale_order">
											<t t-set="warning" t-value="website_sale_order._get_shop_warning(clear=False)" />
											<div t-if="warning" class="alert alert-warning" role="alert">
												<strong>
													Advertencia!
												</strong>
												<t t-esc="website_sale_order._get_shop_warning()" />
											</div>
										</t>
									</div>
									<t t-call="website_sale.total">
										<t t-set="_cart_total_classes" t-valuef="border-top pt-3" />
									</t>
									<div t-if="show_navigation_button" class="o_cta_navigation_container position-absolute position-lg-static start-0 bottom-0 col-12">
										<t t-call="website_sale.navigation_buttons" />
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</xpath>
		<xpath expr="//input[@name='vat']/.." position="before">
			<t t-if="mode[1] == 'billing'" position="inside">
				<t t-if="res_company.country_id.code == 'PE'">
					<t t-set="partner" t-value="website_sale_order.partner_id" />
					<div class="w-100" />
					<t t-call="l10n_pe_website_sale.partner_info" />
				</t>
			</t>
		</xpath>
		<label for="vat" position="replace">
			<t t-if="res_company.country_id.code != 'PE'">
				$0
			</t>
			<t t-else="">
				<label class="col-form-label label-optional" for="vat">
					Identification Number
				</label>
			</t>
		</label>
		<xpath expr="//select[@name='country_id']" position="attributes">
			<attribute name="t-att-data-company_country_code">
				res_company.country_id.code
			</attribute>
		</xpath>
		<xpath expr="//select[@name='state_id']/.." position="after">
			<t t-if="res_company.country_id.code == 'PE'">
				<t t-call="l10n_pe_website_sale.partner_address_info" />
			</t>
		</xpath>
		<!-- Sets the country code for every country option -->
		<xpath expr="//t[@t-foreach='countries']//option" position="attributes">
			<attribute name="t-att-code">
				c.code
			</attribute>
		</xpath>
	</template>
</odoo>
